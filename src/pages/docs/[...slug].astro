---
import { getCollection } from 'astro:content';
import MainLayout from '../../layouts/MainLayout.astro';

export async function getStaticPaths() {
  const docsEntries = await getCollection('docs');
  return docsEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// Map slugs to readable names
const categoryNames = {
    'design': 'Design System',
    'plugins': 'Plugins',
    'themes': 'Themes',
    'workflow': 'Workflow',
    'docs': 'Docs'
};

const slugs = entry.slug.split('/');
const breadcrumbs = slugs.map((slug, index) => {
    const path = '/docs/' + slugs.slice(0, index + 1).join('/');
    const label = categoryNames[slug] || slug.charAt(0).toUpperCase() + slug.slice(1).replace(/-/g, ' ');
    return { path, label };
});
// Remove the last item (current page) as it's handled separately in the UI
breadcrumbs.pop();

// Pagination Logic
const allDocs = await getCollection('docs');
const orderedSlugs = [
    '01-getting-started',
    'themes/intro',
    'themes/lenin',
    'plugins/intro',
    'plugins/news-slider',
    'plugins/preheader',
    'design/intro',
    'design/colors',
    'design/typography',
    'workflow/intro',
    'workflow/git-standards'
];

const currentIndex = orderedSlugs.indexOf(entry.slug);
const prevSlug = currentIndex > 0 ? orderedSlugs[currentIndex - 1] : null;
const nextSlug = currentIndex < orderedSlugs.length - 1 ? orderedSlugs[currentIndex + 1] : null;

const prev = prevSlug ? allDocs.find(d => d.slug === prevSlug) : null;
const next = nextSlug ? allDocs.find(d => d.slug === nextSlug) : null;
---

<MainLayout title={entry.data.title} headings={await entry.render().then(r => r.headings)}>
  <div class="max-w-[800px] mx-auto">
      
      <!-- Breadcrumbs -->
      <nav class="flex items-center text-[13px] text-[#5F6368] mb-8 select-none">
          <a href="/" class="hover:text-[#202124] transition-colors">Home</a>
          <a href="/" class="hover:text-[#202124] transition-colors">Home</a>
          {breadcrumbs.map(crumb => (
            <>
                <span class="material-symbols-outlined text-[10px] text-[#9AA0A6] mx-2">chevron_right</span>
                <a href={crumb.path.endsWith('intro') ? crumb.path : crumb.path + '/intro'} class="hover:text-[#202124] transition-colors">{crumb.label}</a>
            </>
          ))}
          <span class="material-symbols-outlined text-[10px] text-[#9AA0A6] mx-2">chevron_right</span>
          <span class="text-[#202124] font-medium truncate">{entry.data.title}</span>
      </nav>

      <article class="prose prose-gray max-w-none">
        <div class="mb-12 border-b border-[#DADCE0] pb-8">
            <h1 class="text-[40px] leading-tight font-condensed font-bold text-[#202124] mb-4 tracking-tight">{entry.data.title}</h1>
            <p class="text-[20px] text-[#5F6368] leading-relaxed font-light">{entry.data.description}</p>
        </div>
        <div class="content-body">
            <Content />
        </div>
      </article>

      <!-- Pagination -->
      <div class="mt-20 pt-8 border-t border-[#DADCE0] grid grid-cols-2 gap-4">
          {prev ? (
              <a href={`/docs/${prev.slug}`} class="group flex flex-col items-start p-4 -ml-4 rounded-lg hover:bg-[#F8F9FA] transition-colors">
                  <span class="text-[12px] font-medium text-[#5F6368] mb-1 group-hover:text-[#1967D2] transition-colors">Previous</span>
                  <span class="text-[16px] font-medium text-[#202124] group-hover:text-[#1967D2] transition-colors">{prev.data.title}</span>
              </a>
          ) : <div></div>}

          {next ? (
              <a href={`/docs/${next.slug}`} class="group flex flex-col items-end p-4 -mr-4 rounded-lg hover:bg-[#F8F9FA] transition-colors text-right">
                  <span class="text-[12px] font-medium text-[#5F6368] mb-1 group-hover:text-[#1967D2] transition-colors">Next</span>
                  <span class="text-[16px] font-medium text-[#202124] group-hover:text-[#1967D2] transition-colors">{next.data.title}</span>
              </a>
          ) : <div></div>}
      </div>
  </div>
</MainLayout>

<style is:global>
    /* Minimal prose overrides to match Google style */
    .prose h1, .prose h2, .prose h3 {
        font-family: var(--font-condensed);
        color: #202124; /* Google almost-black */
    }
    .prose h2 {
        margin-top: 2.5em;
        font-size: 1.75rem;
    }
    .prose p {
        line-height: 1.8;
    }
    /* Code Blocks - Dark Theme */
    .prose pre {
        background-color: #202124 !important;
        color: #e8eaed !important;
        padding: 1.5em;
        border-radius: 12px;
        overflow-x: auto;
        font-size: 14px;
        margin: 2em 0;
        border: 1px solid #3c4043;
    }
    
    /* Inline Code */
    .prose code {
        background-color: #f1f3f4;
        color: #d93025;
        padding: 0.2em 0.4em;
        border-radius: 4px;
        font-weight: 500;
        font-size: 0.875em;
    }

    /* Reset for code inside pre (don't inherit inline styles) */
    .prose pre code {
        background-color: transparent;
        color: inherit;
        padding: 0;
        border-radius: 0;
        font-weight: normal;
        font-size: inherit;
    }
</style>
